# V4激进配置 - 基于V3结果的激进优化策略
# 重点解决特征学习能力不足和预测偏向问题

model:
  input_dim: 6  # 6维输入：[x, y, vx, vy, ax, ay]
  encoder_hidden_dim: 256
  encoder_output_dim: 128
  projection_hidden_dim: 512
  projection_output_dim: 8
  temperature: 0.05  # 下调温度增强区分度，配合高阈值评估
  encoder_layers: 2
  projection_layers: 4
  use_dual_projection: false  # 默认使用共享投影头，贴近原论文
  dropout: 0.25  # 适度上调 Dropout，增强正则化

data:
  sequence_length: 13
  batch_size: 32  # 使用合适的批次大小
  num_workers: 0  # 修复Windows多进程问题
  group_by_scene: true  # 训练按场景分组批次，便于批内负样本
  augmentation: true
  # 归一化仅在数据加载器内部执行一次（使用加载器默认值）

training:
  epochs: 100  # 从V3的60减少到50
  learning_rate: 0.0005  # 从V3的0.0001大幅提升至0.0005，激进学习
  weight_decay: 0.0005  # 从V3的0.001降至0.0005，减少权重衰减
  warmup_epochs: 5  # 从V3的3增加到5，更长预热
  gradient_clip_norm: 1.0
  mixed_precision: true

optimizer:
  type: AdamW
  betas: [0.9, 0.999]
  eps: 1e-8

scheduler:
  type: CosineAnnealingLR  # 改为Cosine Annealing，更激进的学习率调度
  T_max: 50
  eta_min: 1e-6

loss:
  type: paper
  margin: 1.0
  temperature: 0.05  # 与模型温度参数保持一致
  lambda_sym: 10.0  # 与论文一致，强化对称约束
  gradient_clip_norm: 1.0
  # 更激进的类别平衡损失配置
  class_weights: [3.0, 1.0]  # 从V3的[2.0, 1.0]提升至[3.0, 1.0]
  focal_loss_alpha: 0.8  # 从V3的0.75提升至0.8
  focal_loss_gamma: 2.5  # 从V3的2.0提升至2.5
  use_infonce: false
  alpha_infonce: 1.0

evaluation:
  k_values: [2, 5, 10, 15, 20]  # 扩展评估K范围，包含更大的K
  auto_threshold_from_margin: true
  similarity_threshold: 0.50
  threshold_grid: [0.45, 0.50, 0.55, 0.60, 0.65, 0.70]
  output_dir: evaluation_results

logging:
  log_dir: logs_v4
  checkpoint_dir: checkpoints_v4
  tensorboard_dir: runs/contrastive_tsadcnn_v4

data_paths:
  train_data: data/csv/train_correct.csv
  test_data: data/csv/test_correct.csv

early_stopping:
  patience: 8  # 从V3的10降至8，更早停止
  min_delta: 0.001
  monitor: val_loss

checkpoint:
  save_best: true
  save_last: true
  save_frequency: 5

# V4激进数据增强配置
augmentation:
  noise_std: 0.03  # 从V3的0.02增加到0.03
  rotation_prob: 0.4  # 从V3的0.3增加到0.4
  scale_prob: 0.4  # 从V3的0.3增加到0.4
  time_shift_prob: 0.4  # 从V3的0.3增加到0.4
  dropout_prob: 0.15  # 从V3的0.1增加到0.15

# V4正则化配置 - 暂时禁用谱归一化
regularization:
  spectral_norm: false  # 从V3的true改为false，减少约束
  batch_norm: true
  layer_norm: false
  
# V4激进损失函数权重配置
loss_weights:
  contrastive: 0.3  # 从V3的1.0降至0.3，减少对比损失权重
  classification: 5.0  # 从V3的2.0大幅提升至5.0，强化分类学习
  symmetric: 0.1  # 从V3的0.5降至0.1
  focal: 2.0  # 从V3的1.5提升至2.0